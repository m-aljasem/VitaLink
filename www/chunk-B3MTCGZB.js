import{a as n,b as h}from"./chunk-7VI3B7OV.js";import{a as p}from"./chunk-FEUMV7UB.js";import{f}from"./chunk-IPUYINSA.js";import{g as r}from"./chunk-2R6CW7ES.js";var m=h("LocalNotifications",{web:()=>import("./chunk-DMR5XVWD.js").then(o=>new o.LocalNotificationsWeb)});var R=(()=>{let i=class i{constructor(){this.supabase=p()}requestPermission(){return r(this,null,function*(){if(n.isNativePlatform()){let{display:t}=yield m.requestPermissions();return t==="granted"}return!1})}createReminder(t){return r(this,null,function*(){let{data:e,error:a}=yield this.supabase.from("reminders").insert(t).select().single();return!a&&e&&n.isNativePlatform()&&(yield this.scheduleNotification(e)),{data:e,error:a}})}getReminders(t){return r(this,null,function*(){let{data:e,error:a}=yield this.supabase.from("reminders").select("*").eq("user_id",t).order("created_at",{ascending:!1});return{data:e,error:a}})}updateReminder(t,e){return r(this,null,function*(){let{data:a,error:c}=yield this.supabase.from("reminders").update(e).eq("id",t).select().single();return!c&&a&&n.isNativePlatform()&&(yield this.scheduleNotification(a)),{data:a,error:c}})}deleteReminder(t){return r(this,null,function*(){let{error:e}=yield this.supabase.from("reminders").delete().eq("id",t);return{error:e}})}scheduleNotification(t){return r(this,null,function*(){if(!(!t.enabled||!t.local_time)&&n.isNativePlatform()){let[e,a]=t.local_time.split(":").map(Number),u=(t.days||[]).map((s,d)=>{let l={Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sun:0};return{title:t.title,body:"Time to log your health data",id:parseInt(`${t.id?.replace(/-/g,"").substring(0,8)}${d}`,16)%2147483647,schedule:{on:{day:l[s],hour:e,minute:a},repeats:!0}}});yield m.schedule({notifications:u})}})}checkWebReminders(t){return r(this,null,function*(){if(n.isNativePlatform())return[];let{data:e}=yield this.getReminders(t);if(!e)return[];let a=new Date,c=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,u=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a.getDay()];return e.filter(s=>{if(!s.enabled||!s.local_time||!s.days)return!1;let[d,l]=s.local_time.split(":").map(Number),[y,b]=c.split(":").map(Number),g=d*60+l,w=y*60+b;return Math.abs(g-w)<=1&&s.days.includes(u)})})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();export{R as a};
