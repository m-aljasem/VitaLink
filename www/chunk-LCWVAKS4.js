import{a as q}from"./chunk-GCNMMXZU.js";import{a as Y}from"./chunk-ZL5SRYO7.js";import{b as X}from"./chunk-FEUMV7UB.js";import{A as u,Aa as j,Ba as $,Ea as U,F as l,Fa as z,G as f,H as h,I as E,M as p,N as m,O as S,Oa as G,P as w,Pa as H,Q as M,ha as N,i as T,j as P,ja as R,ka as b,l as i,n as _,o as y,oa as V,p as v,pa as D,qa as B,r as g,ra as A,s as c,sa as L,t as a,y as I,z as x,za as F}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as k,b as O,g as d}from"./chunk-2R6CW7ES.js";function K(r,s){if(r&1){let o=I();c(0,"ion-card",9)(1,"ion-card-content")(2,"div",10)(3,"h3"),l(4),a(),c(5,"p"),l(6),p(7,"translate"),a()(),c(8,"ion-button",11),x("click",function(){T(o);let t=u();return P(t.shareViaOS())}),l(9),p(10,"translate"),a()()()}if(r&2){let o=u();i(4),f(o.currentToken.code),i(2),E("",m(7,4,"CONNECT.PROVIDER_EXPIRES"),": ",o.formatTimeRemaining(o.timeRemaining)),i(3),h(" ",m(10,6,"CONNECT.SHARE_VIA_OS")," ")}}function Q(r,s){if(r&1){let o=I();c(0,"ion-item")(1,"ion-label")(2,"h3"),l(3),a(),c(4,"p"),l(5),a()(),c(6,"ion-button",13),x("click",function(){let t=T(o).$implicit,n=u(2);return P(n.removePatient(t))}),l(7),p(8,"translate"),a()()}if(r&2){let o=s.$implicit,e=u(2);i(3),E("",o.patientProfile==null?null:o.patientProfile.first_name," ",o.patientProfile==null?null:o.patientProfile.last_name),i(2),h("Connected: ",e.formatDate(o.created_at)),i(2),h(" ",m(8,4,"CONNECT.PROVIDER_REMOVE")," ")}}function W(r,s){if(r&1&&(c(0,"ion-list"),v(1,Q,9,6,"ion-item",12),a()),r&2){let o=u();i(),g("ngForOf",o.patients)}}function Z(r,s){r&1&&(c(0,"ion-text",14),l(1),p(2,"translate"),a()),r&2&&(i(),h(" ",m(2,1,"CONNECT.PROVIDER_NO_PATIENTS")," "))}var pe=(()=>{let s=class s{constructor(e,t,n,C,J){this.authService=e,this.sharingService=t,this.profileService=n,this.toastController=C,this.alertController=J,this.patients=[],this.currentToken=null,this.timeRemaining=0}ngOnInit(){return d(this,null,function*(){yield this.loadPatients()})}ngOnDestroy(){this.tokenExpiryTimer&&clearInterval(this.tokenExpiryTimer)}loadPatients(){return d(this,null,function*(){let e=this.authService.getCurrentUser();if(!e)return;let{data:t}=yield this.sharingService.getProviderLinks(e.id);t&&(this.patients=yield Promise.all(t.map(n=>d(this,null,function*(){let{data:C}=yield this.profileService.getProfile(n.patient_id);return O(k({},n),{patientProfile:C})}))))})}generateCode(){return d(this,null,function*(){let e=this.authService.getCurrentUser();if(!e)return;let{data:t,error:n}=yield this.sharingService.createToken(e.id);if(n){yield(yield this.toastController.create({message:"Failed to generate code",duration:2e3,color:"danger"})).present();return}this.currentToken=t||null,this.currentToken&&this.startExpiryTimer()})}startExpiryTimer(){this.tokenExpiryTimer&&clearInterval(this.tokenExpiryTimer),this.tokenExpiryTimer=setInterval(()=>{if(!this.currentToken){clearInterval(this.tokenExpiryTimer);return}let e=new Date().getTime(),t=new Date(this.currentToken.expires_at).getTime(),n=Math.max(0,Math.floor((t-e)/1e3));this.timeRemaining=n,n===0&&(this.currentToken=null,clearInterval(this.tokenExpiryTimer))},1e3)}formatTimeRemaining(e){let t=Math.floor(e/60),n=e%60;return`${t}:${n.toString().padStart(2,"0")}`}shareViaOS(){return d(this,null,function*(){if(this.currentToken)if(navigator.share)try{yield navigator.share({title:"VitaLink Connection Code",text:`Use this code to connect: ${this.currentToken.code}`,url:window.location.origin})}catch{}else yield navigator.clipboard.writeText(this.currentToken.code),yield(yield this.toastController.create({message:"Code copied to clipboard",duration:2e3,color:"success"})).present()})}removePatient(e){return d(this,null,function*(){yield(yield this.alertController.create({header:"Remove Patient",message:"Are you sure you want to remove this patient?",buttons:[{text:"Cancel",role:"cancel"},{text:"Remove",role:"destructive",handler:()=>d(this,null,function*(){yield this.sharingService.revokeLink(e.id),yield this.loadPatients()})}]})).present()})}formatDate(e){return e?new Date(e).toLocaleDateString():""}};s.\u0275fac=function(t){return new(t||s)(_(X),_(q),_(Y),_(z),_(U))},s.\u0275cmp=y({type:s,selectors:[["app-provider-connect"]],decls:24,vars:20,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"provider-connect-container"],[1,"connect-header"],["expand","block",1,"ion-margin-top",3,"click"],["class","token-card",4,"ngIf"],[1,"patients-section","ion-margin-top"],[4,"ngIf"],["color","medium",4,"ngIf"],[1,"token-card"],[1,"token-display"],["expand","block","fill","outline",1,"ion-margin-top",3,"click"],[4,"ngFor","ngForOf"],["fill","clear","slot","end",3,"click"],["color","medium"]],template:function(t,n){t&1&&(c(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),l(3),p(4,"translate"),a()()(),c(5,"ion-content",1)(6,"div",2)(7,"div",3)(8,"h2"),l(9),p(10,"translate"),a(),c(11,"p"),l(12),p(13,"translate"),a()(),c(14,"ion-button",4),x("click",function(){return n.generateCode()}),l(15),p(16,"translate"),a(),v(17,K,11,8,"ion-card",5),c(18,"div",6)(19,"h3"),l(20),p(21,"translate"),a(),v(22,W,2,1,"ion-list",7)(23,Z,3,3,"ion-text",8),a()()()),t&2&&(g("translucent",!0),i(3),f(m(4,10,"CONNECT.TITLE")),i(2),g("fullscreen",!0),i(4),f(m(10,12,"CONNECT.PROVIDER_GENERATE")),i(3),f(m(13,14,"CONNECT.SUBTITLE")),i(3),h(" ",m(16,16,"CONNECT.PROVIDER_GENERATE")," "),i(2),g("ngIf",n.currentToken),i(3),f(m(21,18,"CONNECT.PROVIDER_MY_PATIENTS")),i(2),g("ngIf",n.patients.length>0),i(),g("ngIf",n.patients.length===0))},dependencies:[M,S,w,V,D,j,$,N,R,b,L,B,A,F,H,G],styles:[".provider-connect-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.connect-header[_ngcontent-%COMP%]{margin-bottom:2rem}.connect-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:.5rem}.connect-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-text-color);opacity:.7}.token-card[_ngcontent-%COMP%]{margin-top:1.5rem;border-radius:16px}.token-card[_ngcontent-%COMP%]   .token-display[_ngcontent-%COMP%]{text-align:center;margin-bottom:1rem}.token-card[_ngcontent-%COMP%]   .token-display[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:600;letter-spacing:.5rem;color:var(--ion-color-primary);margin:0}.token-card[_ngcontent-%COMP%]   .token-display[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:.5rem;color:var(--ion-text-color);opacity:.7}.patients-section[_ngcontent-%COMP%]{margin-top:2rem}.patients-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}"]});let r=s;return r})();export{pe as ProviderConnectPage};
