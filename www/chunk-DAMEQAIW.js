import{a as W}from"./chunk-H2PNYZY7.js";import{a as Q}from"./chunk-GCNMMXZU.js";import{a as K}from"./chunk-BRRUA5UT.js";import{a as J}from"./chunk-ZL5SRYO7.js";import{b as q}from"./chunk-FEUMV7UB.js";import{A as f,Aa as z,Ba as H,F as d,G as _,H as b,I as M,M as u,N as v,O as k,Oa as G,P as $,Pa as U,Q as B,U as F,W as A,ja as L,k as w,ka as V,l as i,n as h,o as T,oa as R,p as I,pa as j,q as S,r as p,s as c,t as r,u as D,za as N}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as C}from"./chunk-2R6CW7ES.js";function Y(e,o){if(e&1&&(c(0,"p"),d(1),u(2,"translate"),r()),e&2){let a=f();i(),M("",v(2,2,"ONBOARDING.AGE"),": ",a.patientProfile==null?null:a.patientProfile.age)}}function Z(e,o){if(e&1&&(c(0,"div",12)(1,"p",13),d(2),r(),c(3,"p",14),d(4),r()()),e&2){let a=f().$implicit,t=f();i(2),_(t.formatValue(a.latestValue)),i(2),_(t.formatTime(a.latestValue.ts))}}function tt(e,o){if(e&1&&(c(0,"div",15),w(),c(1,"svg",16),D(2,"polyline",17),r()()),e&2){let a=f().$implicit,t=f();i(),S("width",100)("height",30),i(),S("points",t.getTrendLinePoints(a.chartData))("stroke",a.color)}}function et(e,o){if(e&1&&(c(0,"div",18),D(1,"app-line-chart",19),r()),e&2){let a=f().$implicit;i(),p("data",a.chartData)("labels",a.chartLabels)("color",a.color)}}function it(e,o){e&1&&(c(0,"ion-text",20),d(1),u(2,"translate"),r()),e&2&&(i(),b(" ",v(2,1,"HOME.NO_DATA")," "))}function nt(e,o){if(e&1&&(c(0,"div",8)(1,"ion-card")(2,"ion-card-content")(3,"h4"),d(4),u(5,"translate"),r(),I(6,Z,5,2,"div",9)(7,tt,3,4,"div",10)(8,et,2,3,"div",11)(9,it,3,3,"ion-text",7),r()()()),e&2){let a=o.$implicit;i(4),_(v(5,5,a.label)),i(2),p("ngIf",a.latestValue),i(),p("ngIf",a.chartData.length>0),i(),p("ngIf",a.chartData.length>0),i(),p("ngIf",!a.latestValue)}}function at(e,o){e&1&&(c(0,"ion-text",20),d(1),u(2,"translate"),r()),e&2&&(i(),b(" ",v(2,1,"HOME.NO_DATA")," "))}var vt=(()=>{let o=class o{constructor(t,m,n,l,s,P){this.route=t,this.router=m,this.authService=n,this.profileService=l,this.sharingService=s,this.observationService=P,this.patientId="",this.patientProfile=null,this.link=null,this.sharedMetrics=[],this.metricColors={bp:"#EF4444",glucose:"#F59E0B",spo2:"#3B82F6",hr:"#10B981",pain:"#8B5CF6",weight:"#6366F1"}}ngOnInit(){return C(this,null,function*(){if(this.patientId=this.route.snapshot.paramMap.get("id")||"",!this.patientId){this.router.navigate(["/tabs/home"]);return}yield this.loadData()})}loadData(){return C(this,null,function*(){let t=this.authService.getCurrentUser();if(!t)return;let{data:m}=yield this.profileService.getProfile(this.patientId);this.patientProfile=m||null;let{data:n}=yield this.sharingService.getProviderLinks(t.id);if(this.link=n?.find(s=>s.patient_id===this.patientId)||null,!this.link){this.router.navigate(["/tabs/home"]);return}let l=[];this.link.share_bp&&l.push("bp"),this.link.share_glucose&&l.push("glucose"),this.link.share_spo2&&l.push("spo2"),this.link.share_hr&&l.push("hr"),this.link.share_pain&&l.push("pain"),this.link.share_weight&&l.push("weight"),this.sharedMetrics=yield Promise.all(l.map(s=>C(this,null,function*(){let{data:P}=yield this.observationService.getLatestObservation(this.patientId,s),{data:x}=yield this.observationService.getObservationsForChart(this.patientId,s,7),y=(x||[]).map(g=>s==="bp"?g.systolic||0:g.numeric_value||0),O=(x||[]).map(g=>new Date(g.ts).toLocaleDateString());return{metric:s,label:`METRICS.${s.toUpperCase()}`,latestValue:P||null,chartData:y,chartLabels:O,color:this.metricColors[s]}})))})}formatValue(t){return t.metric==="bp"?`${t.systolic}/${t.diastolic} ${t.unit||"mmHg"}`:`${t.numeric_value} ${t.unit||""}`}formatTime(t){return new Date(t).toLocaleString()}getTrendLinePoints(t){if(!t||t.length===0)return"";let m=100,n=30,l=2,s=Math.min(...t),x=Math.max(...t)-s||1;return t.map((O,g)=>{let E=l+g/(t.length-1||1)*(m-2*l),X=n-l-(O-s)/x*(n-2*l);return`${E},${X}`}).join(" ")}};o.\u0275fac=function(m){return new(m||o)(h(F),h(A),h(q),h(J),h(Q),h(K))},o.\u0275cmp=T({type:o,selectors:[["app-provider-patient-detail"]],decls:16,vars:12,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"patient-detail-container"],[1,"patient-info"],[4,"ngIf"],[1,"shared-metrics-section"],["class","metric-section",4,"ngFor","ngForOf"],["color","medium",4,"ngIf"],[1,"metric-section"],["class","latest-value",4,"ngIf"],["class","trend-line",4,"ngIf"],["class","chart-container",4,"ngIf"],[1,"latest-value"],[1,"value"],[1,"time"],[1,"trend-line"],["viewBox","0 0 100 30"],["fill","none","stroke-width","1.5"],[1,"chart-container"],[3,"data","labels","color"],["color","medium"]],template:function(m,n){m&1&&(c(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),d(3),r()()(),c(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"h2"),d(8),r(),I(9,Y,3,4,"p",4),r(),c(10,"div",5)(11,"h3"),d(12),u(13,"translate"),r(),I(14,nt,10,7,"div",6)(15,at,3,3,"ion-text",7),r()()()),m&2&&(p("translucent",!0),i(3),M("",n.patientProfile==null?null:n.patientProfile.first_name," ",n.patientProfile==null?null:n.patientProfile.last_name),i(),p("fullscreen",!0),i(4),M("",n.patientProfile==null?null:n.patientProfile.first_name," ",n.patientProfile==null?null:n.patientProfile.last_name),i(),p("ngIf",n.patientProfile==null?null:n.patientProfile.age),i(3),_(v(13,10,"PROVIDER.SHARED_METRICS")),i(2),p("ngForOf",n.sharedMetrics),i(),p("ngIf",n.sharedMetrics.length===0))},dependencies:[B,k,$,R,j,z,H,L,V,N,U,W,G],styles:[".patient-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.patient-info[_ngcontent-%COMP%]{margin-bottom:2rem}.patient-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:.5rem}.patient-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-text-color);opacity:.7}.shared-metrics-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.metric-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.metric-section[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:0;border-radius:16px}.metric-section[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin-bottom:1rem}.latest-value[_ngcontent-%COMP%]{margin-bottom:1rem}.latest-value[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin:0}.latest-value[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:.875rem;color:var(--ion-text-color);opacity:.6;margin:.25rem 0 0}.trend-line[_ngcontent-%COMP%]{margin:.5rem 0;height:30px;display:flex;align-items:center}.trend-line[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%}.chart-container[_ngcontent-%COMP%]{margin-top:1rem}"]});let e=o;return e})();export{vt as ProviderPatientDetailPage};
