import{a as te}from"./chunk-H2PNYZY7.js";import{a as ee}from"./chunk-BRRUA5UT.js";import{b as $}from"./chunk-FEUMV7UB.js";import{$ as F,A as d,Aa as K,Ba as Y,F as l,Fa as q,G as g,H as w,Ha as J,I as D,J as S,Ja as Q,K as x,L as M,M as p,N as m,O as P,Oa as X,P as B,Pa as Z,Q as V,U as L,W as A,_ as R,ba as W,ha as N,i as v,j as C,l as n,n as T,na as G,o as b,oa as k,p as _,pa as U,qa as j,r as h,ra as H,s,sa as z,t as o,u as O,y,z as E}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as I}from"./chunk-2R6CW7ES.js";function ie(r,c){if(r&1){let a=y();s(0,"div")(1,"ion-item")(2,"ion-label",5),l(3),p(4,"translate"),o(),s(5,"ion-input",12),M("ngModelChange",function(e){v(a);let i=d();return x(i.systolic,e)||(i.systolic=e),C(e)}),o()(),s(6,"ion-item")(7,"ion-label",5),l(8),p(9,"translate"),o(),s(10,"ion-input",12),M("ngModelChange",function(e){v(a);let i=d();return x(i.diastolic,e)||(i.diastolic=e),C(e)}),o()(),s(11,"ion-item")(12,"ion-label",5),l(13),p(14,"translate"),p(15,"translate"),o(),s(16,"ion-input",13),M("ngModelChange",function(e){v(a);let i=d();return x(i.pulse,e)||(i.pulse=e),C(e)}),o()()()}if(r&2){let a=d();n(3),g(m(4,7,"ONBOARDING.SYSTOLIC")),n(2),S("ngModel",a.systolic),n(3),g(m(9,9,"ONBOARDING.DIASTOLIC")),n(2),S("ngModel",a.diastolic),n(3),D("",m(14,11,"METRICS.PULSE")," (",m(15,13,"COMMON.OPTIONAL"),")"),n(3),S("ngModel",a.pulse)}}function ne(r,c){if(r&1){let a=y();s(0,"div")(1,"ion-item")(2,"ion-label",5),l(3),p(4,"translate"),o(),s(5,"ion-input",12),M("ngModelChange",function(e){v(a);let i=d();return x(i.numericValue,e)||(i.numericValue=e),C(e)}),o()()()}if(r&2){let a=d();n(3),g(m(4,2,"METRICS.ENTER_VALUE")),n(2),S("ngModel",a.numericValue)}}function ae(r,c){if(r&1){let a=y();s(0,"ion-chip",17),E("click",function(){let e=v(a).$implicit,i=d(2);return C(i.toggleTag(e))}),l(1),p(2,"translate"),o()}if(r&2){let a=c.$implicit,t=d(2);h("color",t.selectedTags.includes(a)?"primary":"medium"),n(),w(" ",m(2,2,a)," ")}}function oe(r,c){if(r&1&&(s(0,"div",14)(1,"p"),l(2),p(3,"translate"),o(),s(4,"div",15),_(5,ae,3,4,"ion-chip",16),o()()),r&2){let a=d();n(2),g(m(3,2,"METRICS.TAGS")),n(3),h("ngForOf",a.availableTags)}}function re(r,c){if(r&1&&(s(0,"div",18)(1,"h2"),l(2),p(3,"translate"),o(),O(4,"app-line-chart",19),o()),r&2){let a=d();n(2),g(m(3,4,"METRICS.CHART")),n(2),h("data",a.chartData)("labels",a.chartLabels)("color",a.chartColor)}}function se(r,c){if(r&1&&(s(0,"p"),l(1),o()),r&2){let a=d().$implicit;n(),g(a.tags.join(", "))}}function le(r,c){if(r&1&&(s(0,"ion-item")(1,"ion-label")(2,"h3"),l(3),o(),s(4,"p"),l(5),o(),_(6,se,2,1,"p",4),o()()),r&2){let a=c.$implicit,t=d();n(3),g(t.formatValue(a)),n(2),g(t.formatTime(a.ts)),n(),h("ngIf",a.tags&&a.tags.length>0)}}var xe=(()=>{let c=class c{constructor(t,e,i,u,f){this.route=t,this.router=e,this.authService=i,this.observationService=u,this.toastController=f,this.observations=[],this.chartData=[],this.chartLabels=[],this.chartColor="#3B82F6",this.metricColors={bp:"#EF4444",glucose:"#F59E0B",spo2:"#3B82F6",hr:"#10B981",pain:"#8B5CF6",weight:"#6366F1"},this.systolic=null,this.diastolic=null,this.pulse=null,this.numericValue=null,this.selectedTags=[],this.selectedDateTime=new Date().toISOString(),this.availableTags=[]}ngOnInit(){return I(this,null,function*(){let t=this.route.snapshot.paramMap.get("type");if(!t||!["bp","glucose","spo2","hr","pain","weight"].includes(t)){this.router.navigate(["/tabs/home"]);return}this.metric=t,this.chartColor=this.metricColors[this.metric],this.setupTags(),yield this.loadData()})}setupTags(){this.metric==="bp"?this.availableTags=["TAGS.BP_AFTER_WAKE","TAGS.BP_BEFORE_BED","TAGS.BP_STRESS"]:this.metric==="glucose"&&(this.availableTags=["TAGS.GLUCOSE_FASTING","TAGS.GLUCOSE_AFTER_MEAL","TAGS.GLUCOSE_WORKOUT"])}loadData(){return I(this,null,function*(){let t=this.authService.getCurrentUser();if(!t)return;let{data:e}=yield this.observationService.getObservationsByMetric(t.id,this.metric,50);this.observations=e||[];let i=this.observations.slice().reverse();this.chartData=i.map(u=>this.metric==="bp"?u.systolic||0:u.numeric_value||0),this.chartLabels=i.map(u=>new Date(u.ts).toLocaleDateString())})}toggleTag(t){let e=this.selectedTags.indexOf(t);e>-1?this.selectedTags.splice(e,1):this.selectedTags.push(t)}save(){return I(this,null,function*(){let t=this.authService.getCurrentUser();if(!t)return;let e={user_id:t.id,metric:this.metric,ts:this.selectedDateTime,tags:this.selectedTags};if(this.metric==="bp"){if(!this.systolic||!this.diastolic){yield(yield this.toastController.create({message:"Please enter both systolic and diastolic values",duration:2e3,color:"danger"})).present();return}e.systolic=this.systolic,e.diastolic=this.diastolic,this.pulse&&(e.context={pulse:this.pulse})}else{if(!this.numericValue){yield(yield this.toastController.create({message:"Please enter a value",duration:2e3,color:"danger"})).present();return}e.numeric_value=this.numericValue,this.metric==="glucose"?e.unit="mg/dL":this.metric==="spo2"?e.unit="%":this.metric==="hr"?e.unit="bpm":this.metric==="weight"&&(e.unit="kg")}let{error:i}=yield this.observationService.createObservation(e);i?yield(yield this.toastController.create({message:"Failed to save",duration:2e3,color:"danger"})).present():(yield(yield this.toastController.create({message:"Saved successfully",duration:2e3,color:"success"})).present(),this.systolic=null,this.diastolic=null,this.numericValue=null,this.selectedTags=[],this.selectedDateTime=new Date().toISOString(),yield this.loadData())})}formatValue(t){return t.metric==="bp"?`${t.systolic}/${t.diastolic} ${t.unit||"mmHg"}`:`${t.numeric_value} ${t.unit||""}`}formatTime(t){return new Date(t).toLocaleString()}};c.\u0275fac=function(e){return new(e||c)(T(L),T(A),T($),T(ee),T(q))},c.\u0275cmp=b({type:c,selectors:[["app-metric-detail"]],decls:29,vars:23,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"metric-detail-container"],[1,"entry-form"],[4,"ngIf"],["position","stacked"],["presentation","date-time",3,"ngModelChange","ngModel"],["class","tags-section",4,"ngIf"],["expand","block",1,"ion-margin-top",3,"click"],["class","chart-section",4,"ngIf"],[1,"history-section"],[4,"ngFor","ngForOf"],["type","number",3,"ngModelChange","ngModel"],["type","number","placeholder","bpm",3,"ngModelChange","ngModel"],[1,"tags-section"],[1,"tags-container"],[3,"color","click",4,"ngFor","ngForOf"],[3,"click","color"],[1,"chart-section"],[3,"data","labels","color"]],template:function(e,i){e&1&&(s(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),l(3),p(4,"translate"),o()()(),s(5,"ion-content",1)(6,"div",2)(7,"div",3)(8,"h2"),l(9),p(10,"translate"),o(),_(11,ie,17,15,"div",4)(12,ne,6,4,"div",4),s(13,"ion-item")(14,"ion-label",5),l(15),p(16,"translate"),o(),s(17,"ion-datetime",6),M("ngModelChange",function(f){return x(i.selectedDateTime,f)||(i.selectedDateTime=f),f}),o()(),_(18,oe,6,4,"div",7),s(19,"ion-button",8),E("click",function(){return i.save()}),l(20),p(21,"translate"),o()(),_(22,re,5,6,"div",9),s(23,"div",10)(24,"h2"),l(25),p(26,"translate"),o(),s(27,"ion-list"),_(28,le,7,3,"ion-item",11),o()()()()),e&2&&(h("translucent",!0),n(3),g(m(4,13,"METRICS."+i.metric.toUpperCase())),n(2),h("fullscreen",!0),n(4),g(m(10,15,"METRICS.ENTER_VALUE")),n(2),h("ngIf",i.metric==="bp"),n(),h("ngIf",i.metric!=="bp"),n(3),g(m(16,17,"METRICS.DATE_TIME")),n(2),S("ngModel",i.selectedDateTime),n(),h("ngIf",i.availableTags.length>0),n(2),w(" ",m(21,19,"COMMON.SAVE")," "),n(2),h("ngIf",i.chartData.length>0),n(3),g(m(26,21,"METRICS.HISTORY")),n(3),h("ngForOf",i.observations))},dependencies:[V,P,B,W,R,F,k,U,K,Y,N,Q,j,H,J,G,z,Z,te,X],styles:[".metric-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.entry-form[_ngcontent-%COMP%]{margin-bottom:2rem}.entry-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.tags-section[_ngcontent-%COMP%]{margin-top:1rem}.tags-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem;font-weight:500}.tags-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.chart-section[_ngcontent-%COMP%]{margin-bottom:2rem}.chart-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .history-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}"]});let r=c;return r})();export{xe as MetricDetailPage};
