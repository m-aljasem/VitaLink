import{a as Ie}from"./chunk-GCNMMXZU.js";import{a as se}from"./chunk-BRRUA5UT.js";import{a as le}from"./chunk-ZL5SRYO7.js";import{b as ce,c as pe,d as me,f as de,j as fe,k as ge,l as he,n as ue,o as _e,q as ve,r as N}from"./chunk-ZJ66G7QH.js";import{b as U}from"./chunk-FEUMV7UB.js";import{A as h,Aa as oe,Ba as ae,E as Y,F as p,G as v,H as E,I as S,Ia as w,M as f,N as g,O as G,Oa as b,P as M,Pa as D,Q as O,W as K,fa as Q,ha as X,ja as Z,k as J,ka as ee,l as o,n as I,na as te,o as P,oa as $,p as d,pa as ie,q as V,qa as L,r as c,ra as j,s,sa as z,t as l,ta as ne,u as _,ua as re,z as T,za as y}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as W,b as q,g as x}from"./chunk-2R6CW7ES.js";function Ee(t,n){if(t&1&&_(0,"ion-icon",8),t&2){let i=h();Y("color",i.trend==="up"?"#10B981":"#EF4444"),c("name",i.trend==="up"?"arrow-up":"arrow-down")}}function Me(t,n){if(t&1&&(s(0,"div",9),J(),s(1,"svg",10),_(2,"polyline",11),l()()),t&2){let i=h();o(),V("width",60)("height",20),o(),V("points",i.getSparklinePoints())("stroke",i.color)}}function Oe(t,n){if(t&1&&(s(0,"ion-text",12),p(1),f(2,"translate"),l()),t&2){let i=h();o(),S(" ",g(2,2,"HOME.LAST"),": ",i.formatTime(i.lastTime)," ")}}var Te=(()=>{let n=class n{constructor(e){this.router=e,this.value=null,this.lastTime=null,this.trend="neutral",this.color="#3B82F6",this.sparklineData=[],N({arrowUp:pe,arrowDown:ce,remove:ge})}getMetricLabel(){return{bp:"METRICS.BP",glucose:"METRICS.GLUCOSE",spo2:"METRICS.SPO2",hr:"METRICS.HR",pain:"METRICS.PAIN",weight:"METRICS.WEIGHT"}[this.metric]}formatTime(e){return e?new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""}navigateToDetail(){this.router.navigate(["/metric",this.metric])}getSparklinePoints(){if(!this.sparklineData||this.sparklineData.length===0)return"";let e=60,r=20,a=2,m=this.sparklineData,u=Math.min(...m),R=Math.max(...m)-u||1;return m.map((C,H)=>{let B=a+H/(m.length-1||1)*(e-2*a),A=r-a-(C-u)/R*(r-2*a);return`${B},${A}`}).join(" ")}};n.\u0275fac=function(r){return new(r||n)(I(K))},n.\u0275cmp=P({type:n,selectors:[["app-metric-card"]],inputs:{metric:"metric",value:"value",lastTime:"lastTime",trend:"trend",color:"color",sparklineData:"sparklineData"},decls:13,vars:11,consts:[[1,"metric-card",3,"click"],[1,"metric-header"],[1,"metric-label"],[3,"name","color",4,"ngIf"],[1,"metric-value"],["class","sparkline-container",4,"ngIf"],[1,"metric-footer"],["class","metric-time",4,"ngIf"],[3,"name"],[1,"sparkline-container"],["viewBox","0 0 60 20",1,"sparkline"],["fill","none","stroke-width","1.5"],[1,"metric-time"]],template:function(r,a){r&1&&(s(0,"ion-card",0),T("click",function(){return a.navigateToDetail()}),s(1,"ion-card-content")(2,"div",1)(3,"ion-text",2),p(4),f(5,"translate"),l(),d(6,Ee,1,3,"ion-icon",3),l(),s(7,"div",4),p(8),f(9,"translate"),l(),d(10,Me,3,4,"div",5),s(11,"div",6),d(12,Oe,3,4,"ion-text",7),l()()()),r&2&&(o(4),v(g(5,7,a.getMetricLabel())),o(2),c("ngIf",a.trend!=="neutral"),o(),Y("color",a.color),o(),E(" ",a.value||g(9,9,"HOME.NO_DATA")," "),o(2),c("ngIf",a.sparklineData&&a.sparklineData.length>0),o(2),c("ngIf",a.lastTime))},dependencies:[O,M,Z,ee,y,w,D,b],styles:[".metric-card[_ngcontent-%COMP%]{margin:0;border-radius:16px;box-shadow:0 1px 3px #0000001a;cursor:pointer;transition:transform .2s,box-shadow .2s}.metric-card[_ngcontent-%COMP%]:active{transform:scale(.98)}.metric-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:1rem}.metric-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.metric-header[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--ion-text-color);opacity:.7}.metric-value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.sparkline-container[_ngcontent-%COMP%]{margin:.5rem 0;height:20px;display:flex;align-items:center}.sparkline-container[_ngcontent-%COMP%]   .sparkline[_ngcontent-%COMP%]{width:100%;height:100%}.metric-footer[_ngcontent-%COMP%]   .metric-time[_ngcontent-%COMP%]{font-size:.75rem;color:var(--ion-text-color);opacity:.6}"]});let t=n;return t})();function we(t,n){if(t&1&&(s(0,"span",4),p(1),l()),t&2){let i=h();o(),v(i.providers.length)}}function be(t,n){if(t&1&&(s(0,"ion-item")(1,"ion-label")(2,"h4"),p(3),l(),s(4,"p"),p(5),f(6,"translate"),l()()()),t&2){let i=n.$implicit,e=h(3);o(3),S("",i.providerProfile==null?null:i.providerProfile.first_name," ",i.providerProfile==null?null:i.providerProfile.last_name),o(2),S("",e.getSharedMetricsCount(i)," ",g(6,4,"CONNECT.SHARING_OPTIONS"))}}function De(t,n){if(t&1&&(s(0,"ion-list"),d(1,be,7,6,"ion-item",8),l()),t&2){let i=h(2);o(),c("ngForOf",i.providers)}}function Ne(t,n){t&1&&(s(0,"ion-text",9),p(1),f(2,"translate"),l()),t&2&&(o(),E(" ",g(2,1,"CONNECT.NO_PROVIDERS")," "))}function Re(t,n){if(t&1&&(s(0,"ion-content",5)(1,"h3"),p(2),f(3,"translate"),l(),d(4,De,2,1,"ion-list",6)(5,Ne,3,3,"ion-text",7),l()),t&2){let i=h();o(2),v(g(3,3,"CONNECT.MY_PROVIDERS")),o(2),c("ngIf",i.providers.length>0),o(),c("ngIf",i.providers.length===0)}}var Pe=(()=>{let n=class n{constructor(e,r,a){this.authService=e,this.sharingService=r,this.profileService=a,this.providers=[],this.showPopover=!1,N({shareOutline:ue})}ngOnInit(){return x(this,null,function*(){if(!this.authService.getCurrentUser())return;(yield this.authService.getCurrentProfile())?.role==="patient"&&(yield this.loadProviders())})}loadProviders(){return x(this,null,function*(){let e=this.authService.getCurrentUser();if(!e)return;let{data:r}=yield this.sharingService.getPatientLinks(e.id);r&&(this.providers=yield Promise.all(r.map(a=>x(this,null,function*(){let{data:m}=yield this.profileService.getProfile(a.provider_id);return q(W({},a),{providerProfile:m})}))))})}getSharedMetricsCount(e){let r=0;return e.share_bp&&r++,e.share_glucose&&r++,e.share_spo2&&r++,e.share_hr&&r++,e.share_pain&&r++,e.share_weight&&r++,r}};n.\u0275fac=function(r){return new(r||n)(I(U),I(Ie),I(le))},n.\u0275cmp=P({type:n,selectors:[["app-sharing-dot"]],decls:5,vars:2,consts:[["fill","clear","size","small",3,"click"],["name","share-outline"],["class","badge",4,"ngIf"],[3,"didDismiss","isOpen"],[1,"badge"],[1,"ion-padding"],[4,"ngIf"],["color","medium",4,"ngIf"],[4,"ngFor","ngForOf"],["color","medium"]],template:function(r,a){r&1&&(s(0,"ion-button",0),T("click",function(){return a.showPopover=!a.showPopover}),_(1,"ion-icon",1),d(2,we,2,1,"span",2),l(),s(3,"ion-popover",3),T("didDismiss",function(){return a.showPopover=!1}),d(4,Re,6,5,"ng-template"),l()),r&2&&(o(2),c("ngIf",a.providers.length>0),o(),c("isOpen",a.showPopover))},dependencies:[O,G,M,w,X,Q,z,L,j,$,y,D,b],styles:[".badge[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background:var(--ion-color-danger);color:#fff;border-radius:50%;width:18px;height:18px;font-size:10px;display:flex;align-items:center;justify-content:center}"]});let t=n;return t})();function ke(t,n){if(t&1&&_(0,"app-metric-card",11),t&2){let i=n.$implicit;c("metric",i.metric)("value",i.value)("lastTime",i.lastTime)("trend",i.trend)("color",i.color)("sparklineData",i.sparklineData)}}function Fe(t,n){if(t&1&&(s(0,"ion-chip",17),p(1),f(2,"translate"),l()),t&2){let i=n.$implicit;o(),v(g(2,1,i))}}function He(t,n){if(t&1&&(s(0,"p",15),d(1,Fe,3,3,"ion-chip",16),l()),t&2){let i=h().$implicit;o(),c("ngForOf",i.tags)}}function Be(t,n){if(t&1&&(s(0,"ion-item"),_(1,"ion-icon",13),s(2,"ion-label")(3,"h3"),p(4),f(5,"translate"),l(),s(6,"p"),p(7),l(),d(8,He,2,1,"p",14),l()()),t&2){let i=n.$implicit,e=h(2);o(),c("name",e.getMetricIcon(i.metric))("color",e.metricColors[i.metric]),o(3),v(g(5,6,"METRICS."+i.metric.toUpperCase())),o(3),S("",e.formatMetricValue(i)," \u2022 ",e.formatTime(i.ts)),o(),c("ngIf",i.tags&&i.tags.length>0)}}function Ae(t,n){if(t&1&&(s(0,"ion-list"),d(1,Be,9,8,"ion-item",12),l()),t&2){let i=h();o(),c("ngForOf",i.recentActivity)}}function Ge(t,n){t&1&&(s(0,"ion-text",18),p(1),f(2,"translate"),l()),t&2&&(o(),E(" ",g(2,1,"HOME.NO_ACTIVITY")," "))}var pt=(()=>{let n=class n{constructor(e,r){this.authService=e,this.observationService=r,this.profile=null,this.greeting="",this.metrics=[],this.recentActivity=[],this.metricColors={bp:"#EF4444",glucose:"#F59E0B",spo2:"#3B82F6",hr:"#10B981",pain:"#8B5CF6",weight:"#6366F1"},N({heart:de,water:ve,pulse:fe,thermometer:_e,bandage:me,scale:he})}getMetricIcon(e){return{bp:"pulse",glucose:"water",spo2:"heart",hr:"pulse",pain:"bandage",weight:"scale"}[e]}ngOnInit(){return x(this,null,function*(){this.profile=yield this.authService.getCurrentProfile(),this.updateGreeting(),yield this.loadData()})}updateGreeting(){let e=new Date().getHours();e<12?this.greeting="HOME.GREETING_MORNING":e<17?this.greeting="HOME.GREETING_AFTERNOON":e<21?this.greeting="HOME.GREETING_EVENING":this.greeting="HOME.GREETING_NIGHT"}loadData(){return x(this,null,function*(){let e=this.authService.getCurrentUser();if(!e)return;this.metrics=[];let r=["bp","glucose","spo2","hr","pain","weight"];for(let m of r){let{data:u}=yield this.observationService.getLatestObservation(e.id,m),{data:F}=yield this.observationService.getObservationsForChart(e.id,m,7),R=null,k="neutral",C=[];if(u&&(m==="bp"?R=`${u.systolic}/${u.diastolic}`:R=u.numeric_value?.toString()||null),F&&F.length>=2){C=F.map(A=>m==="bp"?A.systolic||0:A.numeric_value||0);let H=C[C.length-1],B=C[C.length-2];H>B?k="up":H<B?k="down":k="neutral"}this.metrics.push({metric:m,value:R,lastTime:u?.ts||null,trend:k,color:this.metricColors[m],sparklineData:C})}let{data:a}=yield this.observationService.getAllObservations(e.id,20);this.recentActivity=a||[]})}doRefresh(e){return x(this,null,function*(){this.metrics=[],yield this.loadData(),e.target.complete()})}formatMetricValue(e){return e.metric==="bp"?`${e.systolic}/${e.diastolic} mmHg`:`${e.numeric_value} ${e.unit||""}`}formatTime(e){return new Date(e).toLocaleString()}};n.\u0275fac=function(r){return new(r||n)(I(U),I(se))},n.\u0275cmp=P({type:n,selectors:[["app-patient-home"]],decls:22,vars:15,consts:[[3,"translucent"],["slot","end"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"home-container","ion-padding"],[1,"greeting"],[1,"metrics-grid"],[3,"metric","value","lastTime","trend","color","sparklineData",4,"ngFor","ngForOf"],[1,"recent-activity"],[4,"ngIf"],["color","medium",4,"ngIf"],[3,"metric","value","lastTime","trend","color","sparklineData"],[4,"ngFor","ngForOf"],["slot","start",3,"name","color"],["class","tags",4,"ngIf"],[1,"tags"],["size","small",4,"ngFor","ngForOf"],["size","small"],["color","medium"]],template:function(r,a){r&1&&(s(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),p(3),f(4,"translate"),l(),_(5,"app-sharing-dot",1),l()(),s(6,"ion-content",2)(7,"ion-refresher",3),T("ionRefresh",function(u){return a.doRefresh(u)}),_(8,"ion-refresher-content"),l(),s(9,"div",4)(10,"div",5)(11,"h1"),p(12),f(13,"translate"),l()(),s(14,"div",6),d(15,ke,1,6,"app-metric-card",7),l(),s(16,"div",8)(17,"h2"),p(18),f(19,"translate"),l(),d(20,Ae,2,1,"ion-list",9)(21,Ge,3,3,"ion-text",10),l()()()),r&2&&(c("translucent",!0),o(3),v(g(4,9,"APP_NAME")),o(3),c("fullscreen",!0),o(6),S("",g(13,11,a.greeting),", ",(a.profile==null?null:a.profile.first_name)||"User"),o(3),c("ngForOf",a.metrics),o(3),v(g(19,13,"HOME.RECENT_ACTIVITY")),o(2),c("ngIf",a.recentActivity.length>0),o(),c("ngIf",a.recentActivity.length===0))},dependencies:[O,G,M,$,ie,oe,ae,ne,re,z,L,j,w,y,te,D,Te,Pe,b],styles:[".home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.greeting[_ngcontent-%COMP%]{margin-bottom:1.5rem}.greeting[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin:0}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:2rem}.recent-activity[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.recent-activity[_ngcontent-%COMP%]   .tags[_ngcontent-%COMP%]{margin-top:.5rem;display:flex;flex-wrap:wrap;gap:.25rem}"]});let t=n;return t})();export{pt as PatientHomePage};
