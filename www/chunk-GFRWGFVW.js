import{a as te}from"./chunk-GCNMMXZU.js";import{a as ee}from"./chunk-BRRUA5UT.js";import{a as Z}from"./chunk-ZL5SRYO7.js";import{b as Q}from"./chunk-FEUMV7UB.js";import{A as x,Aa as Y,Ba as q,F as s,G as p,H as E,I as C,M as d,N as m,O as y,Oa as J,P as b,Pa as K,Q as N,W as A,i as T,j as M,ja as V,ka as B,l as e,la as L,ma as H,n as v,na as F,o as w,oa as z,p as S,pa as j,qa as k,r as h,ra as W,s as t,sa as $,t as i,ta as G,u as R,ua as U,y as D,z as O,za as X}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as u}from"./chunk-2R6CW7ES.js";function ie(c,l){if(c&1&&(t(0,"ion-chip",13),s(1),d(2,"translate"),i()),c&2){let g=l.$implicit;e(),E(" ",m(2,1,"METRICS."+g.toUpperCase())," ")}}function ne(c,l){if(c&1){let g=D();t(0,"ion-item",10),O("click",function(){let a=T(g).$implicit,n=x(2);return M(n.navigateToPatient(a.profile.id))}),t(1,"ion-label")(2,"h3"),s(3),i(),t(4,"p"),s(5),d(6,"translate"),i(),t(7,"div",11),S(8,ie,3,3,"ion-chip",12),i()()()}if(c&2){let g=l.$implicit,r=x(2);e(3),C("",g.profile.first_name," ",g.profile.last_name),e(2),C("",m(6,5,"PROVIDER.LAST_SEEN"),": ",r.formatDate(g.lastSeen)),e(3),h("ngForOf",g.sharedMetrics)}}function re(c,l){if(c&1&&(t(0,"ion-list"),S(1,ne,9,7,"ion-item",9),i()),c&2){let g=x();e(),h("ngForOf",g.patients)}}function ae(c,l){c&1&&(t(0,"ion-text",14),s(1),d(2,"translate"),i()),c&2&&(e(),E(" ",m(2,1,"CONNECT.NO_PROVIDERS")," "))}var ue=(()=>{let l=class l{constructor(r,a,n,o,f){this.authService=r,this.sharingService=a,this.profileService=n,this.observationService=o,this.router=f,this.profile=null,this.stats={totalPatients:0,activeThisWeek:0,newLinks:0,exceptions:0},this.patients=[]}ngOnInit(){return u(this,null,function*(){this.profile=yield this.authService.getCurrentProfile(),yield this.loadData()})}loadData(){return u(this,null,function*(){let r=this.authService.getCurrentUser();if(!r)return;let{data:a}=yield this.sharingService.getProviderLinks(r.id);if(!a)return;this.stats.totalPatients=a.length;let n=new Date;n.setDate(n.getDate()-7),this.patients=yield Promise.all(a.map(o=>u(this,null,function*(){let{data:f}=yield this.profileService.getProfile(o.patient_id),_=[];o.share_bp&&_.push("bp"),o.share_glucose&&_.push("glucose"),o.share_spo2&&_.push("spo2"),o.share_hr&&_.push("hr"),o.share_pain&&_.push("pain"),o.share_weight&&_.push("weight");let I=null;return _.length>0&&(I=(yield Promise.all(_.map(P=>this.observationService.getLatestObservation(o.patient_id,P)))).filter(P=>P.data).map(P=>P.data.ts).sort().reverse()[0]||null,I&&new Date(I)>n&&this.stats.activeThisWeek++),{link:o,profile:f,lastSeen:I,sharedMetrics:_}}))),this.stats.newLinks=a.filter(o=>new Date(o.created_at)>n).length})}doRefresh(r){return u(this,null,function*(){yield this.loadData(),r.target.complete()})}navigateToPatient(r){this.router.navigate(["/provider/patient",r])}formatDate(r){if(!r)return"Never";let a=new Date(r),o=new Date().getTime()-a.getTime(),f=Math.floor(o/(1e3*60*60*24));return f===0?"Today":f===1?"Yesterday":f<7?`${f} days ago`:a.toLocaleDateString()}};l.\u0275fac=function(a){return new(a||l)(v(Q),v(te),v(Z),v(ee),v(A))},l.\u0275cmp=w({type:l,selectors:[["app-provider-home"]],decls:52,vars:30,consts:[[3,"translucent"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"provider-home-container","ion-padding"],[1,"greeting"],[1,"stats-grid"],[1,"patients-section"],[4,"ngIf"],["color","medium",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"shared-metrics"],["size","small",4,"ngFor","ngForOf"],["size","small"],["color","medium"]],template:function(a,n){a&1&&(t(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),s(3),d(4,"translate"),i()()(),t(5,"ion-content",1)(6,"ion-refresher",2),O("ionRefresh",function(f){return n.doRefresh(f)}),R(7,"ion-refresher-content"),i(),t(8,"div",3)(9,"div",4)(10,"h1"),s(11),d(12,"translate"),i()(),t(13,"div",5)(14,"ion-card")(15,"ion-card-header")(16,"ion-card-title"),s(17),i()(),t(18,"ion-card-content")(19,"p"),s(20),d(21,"translate"),i()()(),t(22,"ion-card")(23,"ion-card-header")(24,"ion-card-title"),s(25),i()(),t(26,"ion-card-content")(27,"p"),s(28),d(29,"translate"),i()()(),t(30,"ion-card")(31,"ion-card-header")(32,"ion-card-title"),s(33),i()(),t(34,"ion-card-content")(35,"p"),s(36),d(37,"translate"),i()()(),t(38,"ion-card")(39,"ion-card-header")(40,"ion-card-title"),s(41),i()(),t(42,"ion-card-content")(43,"p"),s(44),d(45,"translate"),i()()()(),t(46,"div",6)(47,"h2"),s(48),d(49,"translate"),i(),S(50,re,2,1,"ion-list",7)(51,ae,3,3,"ion-text",8),i()()()),a&2&&(h("translucent",!0),e(3),p(m(4,16,"APP_NAME")),e(2),h("fullscreen",!0),e(6),C("",m(12,18,"HOME.GREETING_MORNING"),", ",(n.profile==null?null:n.profile.first_name)||"Provider"),e(6),p(n.stats.totalPatients),e(3),p(m(21,20,"PROVIDER.STATS_PATIENTS")),e(5),p(n.stats.activeThisWeek),e(3),p(m(29,22,"PROVIDER.STATS_ACTIVE")),e(5),p(n.stats.newLinks),e(3),p(m(37,24,"PROVIDER.STATS_NEW")),e(5),p(n.stats.exceptions),e(3),p(m(45,26,"PROVIDER.STATS_EXCEPTIONS")),e(4),p(m(49,28,"PROVIDER.PATIENT_DETAIL")),e(2),h("ngIf",n.patients.length>0),e(),h("ngIf",n.patients.length===0))},dependencies:[N,y,b,z,j,Y,q,V,B,L,H,$,k,W,F,X,G,U,K,J],styles:[".provider-home-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.greeting[_ngcontent-%COMP%]{margin-bottom:1.5rem}.greeting[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin:0}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:2rem}.stats-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:0;border-radius:16px}.stats-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:.5rem}.stats-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:var(--ion-color-primary)}.stats-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:0}.stats-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:var(--ion-text-color);opacity:.7}.patients-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.shared-metrics[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem;margin-top:.5rem}"]});let c=l;return c})();export{ue as ProviderHomePage};
