import{a as F}from"./chunk-5S6NIQFG.js";import{a as U}from"./chunk-ZL5SRYO7.js";import{b as R}from"./chunk-FEUMV7UB.js";import{Aa as j,Ba as A,F as p,Fa as B,G as f,H as I,J as S,K as T,L as P,M as g,N as u,Oa as D,P as b,Pa as H,Q as w,U as x,W as E,ha as O,l as i,n as d,o as _,oa as M,p as y,pa as k,r as c,s as a,t as s,u as C,wa as V,z as v}from"./chunk-IPUYINSA.js";import"./chunk-QFN5WVFN.js";import"./chunk-7KGURMOZ.js";import"./chunk-C6GHFGSM.js";import"./chunk-4BHFLD23.js";import"./chunk-MFJQPCIH.js";import"./chunk-PGY34PD4.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as h}from"./chunk-2R6CW7ES.js";function N(o,r){o&1&&C(0,"ion-spinner",9)}function W(o,r){o&1&&(a(0,"span"),p(1),g(2,"translate"),s()),o&2&&(i(),f(u(2,1,"AUTH.VERIFY")))}var ee=(()=>{let r=class r{constructor(t,n,e,m,l){this.authService=t,this.profileService=n,this.router=e,this.route=m,this.toastController=l,this.email="",this.code="",this.loading=!1}ngOnInit(){let t=history.state;this.email=t.email||"",this.email||this.router.navigate(["/auth"])}onCodeComplete(t){return h(this,null,function*(){this.code=t,yield this.verify()})}verify(){return h(this,null,function*(){if(this.code.length!==6)return;this.loading=!0;let{error:t,session:n}=yield this.authService.verifyOTP(this.email,this.code);if(this.loading=!1,t){yield(yield this.toastController.create({message:t.message||"Invalid code",duration:3e3,color:"danger"})).present();return}if(n){let e=yield this.authService.getCurrentProfile();!e||!e.role||!e.first_name?this.router.navigate(["/onboarding"]):this.router.navigate(["/tabs/home"])}})}resendCode(){return h(this,null,function*(){this.loading=!0;let{error:t}=yield this.authService.requestOTP(this.email);this.loading=!1,t?yield(yield this.toastController.create({message:t.message||"Failed to resend code",duration:3e3,color:"danger"})).present():yield(yield this.toastController.create({message:"Code sent",duration:2e3,color:"success"})).present()})}};r.\u0275fac=function(n){return new(n||r)(d(R),d(U),d(E),d(x),d(B))},r.\u0275cmp=_({type:r,selectors:[["app-verify"]],decls:20,vars:17,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"verify-container"],[1,"verify-header"],[3,"codeChange","codeComplete","code"],["expand","block",1,"ion-margin-top",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["fill","clear","expand","block",1,"ion-margin-top",3,"click","disabled"],["name","crescent"]],template:function(n,e){n&1&&(a(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),p(3),g(4,"translate"),s()()(),a(5,"ion-content",1)(6,"div",2)(7,"div",3)(8,"h2"),p(9),g(10,"translate"),s(),a(11,"p"),p(12),s()(),a(13,"app-six-digit-input",4),P("codeChange",function(l){return T(e.code,l)||(e.code=l),l}),v("codeComplete",function(l){return e.onCodeComplete(l)}),s(),a(14,"ion-button",5),v("click",function(){return e.verify()}),y(15,N,1,0,"ion-spinner",6)(16,W,3,3,"span",7),s(),a(17,"ion-button",8),v("click",function(){return e.resendCode()}),p(18),g(19,"translate"),s()()()),n&2&&(c("translucent",!0),i(3),f(u(4,11,"AUTH.VERIFY_CODE")),i(2),c("fullscreen",!0),i(4),f(u(10,13,"AUTH.CODE_SENT")),i(3),f(e.email),i(),S("code",e.code),i(),c("disabled",e.loading||e.code.length!==6),i(),c("ngIf",e.loading),i(),c("ngIf",!e.loading),i(),c("disabled",e.loading),i(),I(" ",u(19,15,"AUTH.RESEND")," "))},dependencies:[w,b,M,k,j,A,O,V,H,F,D],styles:[".verify-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;min-height:100%;max-width:400px;margin:0 auto}.verify-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.verify-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:.5rem}.verify-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-text-color);opacity:.7}"]});let o=r;return o})();export{ee as VerifyPage};
